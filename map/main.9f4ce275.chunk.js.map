{"version":3,"sources":["index.js"],"names":["Option","Select","getBase64","img","callback","reader","FileReader","addEventListener","result","readAsDataURL","Demo","state","loading","Options","data","fileList","handleSubmit","e","preventDefault","props","form","validateFields","err","values","console","log","id","fetch","window","location","protocol","host","method","headers","body","name","replace","project_id","describe","quantity_detials","imageUrl","path","then","res","pid","pathname","split","length","status","text","Modal","success","content","onOk","href","error","title","normFile","Array","isArray","handleChange","info","file","originFileObj","setState","params","reqwest","url","user_data","map","station","value","project_name","setFieldsValue","uploadOnchange","slice","response","showpreview","this","getFieldDecorator","previewVisible","previewImage","uploadButton","type","className","labelCol","span","wrapperCol","onSubmit","Item","label","rules","required","message","placeholder","showSearch","filterOption","input","option","children","toLowerCase","indexOf","listType","showUploadList","onChange","src","alt","style","width","visible","footer","onCancel","handleCancel","offset","htmlType","React","Component","WrappedDemo","Form","create","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.9f4ce275.chunk.js","sourcesContent":["\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'antd/dist/antd.css';\r\nimport './index.css';\r\nimport {\r\n  Form,\r\n  Select,\r\n  InputNumber,\r\n  Switch,\r\n  Radio,\r\n  Slider,\r\n  Button,\r\n  Upload,\r\n  Icon,\r\n  Rate,\r\n  Checkbox,\r\n  Row,\r\n  Col,\r\n  Input,\r\n  Modal,\r\n} from 'antd';\r\nimport reqwest from 'reqwest';\r\nconst { Option } = Select;\r\n\r\nfunction getBase64(img, callback) {\r\n  const reader = new FileReader();\r\n  reader.addEventListener('load', () => callback(reader.result));\r\n  reader.readAsDataURL(img);\r\n}\r\n\r\nclass Demo extends React.Component {\r\n  state={\r\n      loading: false,\r\n      Options:[],\r\n      data:[],\r\n      fileList:[],\r\n    };\r\n  //提交\r\n  handleSubmit = e => {\r\n    e.preventDefault();\r\n    this.props.form.validateFields((err, values) => {\r\n      if (!err) {\r\n        console.log('Received values of form: ', values);\r\n      if (this.state.data.id){\r\n        fetch(window.location.protocol + \"//\"+window.location.host+'/aidsp/api/dataset/' + this.state.data.id + '/', {\r\n              method: 'PUT',\r\n              headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n              },\r\n              body:'name=' + values.name.replace(/&/g,'%26') +\r\n              '&project='+ values.project_id+ \r\n              (values.describe?'&describe='+  values.describe.replace(/&/g, '%26'):'') + \r\n              (values.quantity_detials?'&quantity_detials='+ values.quantity_detials.replace(/&/g,'%26'):'') + \r\n              (this.state.imageUrl?'&img='+ this.state.imageUrl.replace(/&/g, '%26'):'') + \r\n              (values.path?'&path=' + values.path.replace(/&/g, '%26'):''),\r\n        }).then(res=>{\r\n              let pid = window.location.pathname.split(\"/\")[window.location.pathname.split(\"/\").length-2]\r\n              if (res.status == 201 || res.status == 200){\r\n                  Modal.success({\r\n                    content: '提交成功',\r\n                    onOk(){\r\n                      window.location.href = \"/aidsp/dataset_display/\" + pid + '/'\r\n                    }\r\n                  });\r\n                }\r\n              else{\r\n                  return res.text(); \r\n\r\n              }\r\n            \r\n         }).then(data => {\r\n          if (data){\r\n             console.log(2);\r\n                  Modal.error({\r\n                    title: '错误',\r\n                    content: data,\r\n                  });\r\n          } \r\n          });\r\n      }\r\n      else{\r\n        fetch(window.location.protocol + \"//\"+window.location.host+'/aidsp/api/dataset/', {\r\n              method: 'POST',\r\n              headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\" \r\n              },\r\n              body:'name=' + values.name.replace(/&/g, '%26') +\r\n              '&project='+ values.project_id + \r\n              (values.describe?'&describe='+  values.describe.replace(/&/g, '%26'):'') + \r\n              (values.quantity_detials?'&quantity_detials='+ values.quantity_detials.replace(/&/g, '%26'):'') + \r\n              (this.state.imageUrl?'&img='+ this.state.imageUrl.replace(/&/g, '%26'):'') + \r\n              (this.state.fileList[0]?'&path=' + this.state.fileList[0].name.replace(/&/g, '%26'):''),\r\n        }).then(res=>{\r\n              if (res.status == 201 || res.status == 200){\r\n                  Modal.success({\r\n                    content: '提交成功',\r\n                    onOk(){\r\n                        window.location.href = \"/aidsp/dataset\"\r\n\r\n                    }\r\n                  });\r\n                }\r\n              else{\r\n                  \r\n                  Modal.error({\r\n                    title: '错误'+ res.status,\r\n                    content: '提交失败',\r\n                  });\r\n              }\r\n            \r\n        })\r\n      }\r\n\r\n      }\r\n    });\r\n  };\r\n\r\n  normFile = e => {\r\n    console.log('Upload event:', e);\r\n    if (Array.isArray(e)) {\r\n      return e;\r\n    }\r\n    return e && e.fileList;\r\n  };\r\n\r\n  handleChange = info => {\r\n    if (info.file.status === 'uploading') {\r\n      this.setState({ loading: true });\r\n      return;\r\n    }\r\n    if (info.file.status === 'done') {\r\n      // Get this url from response in real world.\r\n      getBase64(info.file.originFileObj, imageUrl =>\r\n        this.setState({\r\n          imageUrl,\r\n          loading: false,\r\n        }),\r\n      );\r\n    }\r\n  };\r\n  \r\n  componentDidMount() {\r\n    this.fetch();\r\n  }\r\n  fetch = (params = {}) => {\r\n    console.log('params:', params);\r\n    reqwest({\r\n      url:window.location.protocol + \"//\"+window.location.host + '/aidsp/api/project/?format=json',\r\n      // url:'http://127.0.0.1:8000/aidsp/api/user/?format=json',\r\n      method: 'get',\r\n    }).then(data => {\r\n      this.setState({user_data: data});\r\n      let Options = data.map(station  => <Option value={station.id}>{station.project_id+'_'+station.project_name}</Option>);\r\n      this.setState({Options: Options});\r\n      console.log(Options)\r\n    }); \r\n    let pid = window.location.pathname.split(\"/\")[window.location.pathname.split(\"/\").length-2]\r\n    reqwest({\r\n      url:window.location.protocol + \"//\"+window.location.host + '/aidsp/api/dataset/'+ pid +'/?format=json',\r\n      // url:'http://127.0.0.1:8000/aidsp/api/user/?format=json',\r\n      method: 'get',\r\n    }).then(data => {\r\n      this.setState({data:data})\r\n      this.setState({imageUrl:data.img})\r\n      this.props.form.setFieldsValue(data);\r\n      if (data.path){\r\n          this.setState({fileList:[{'uid':1,'name':data.path,url: window.location.protocol + \"//\"+window.location.host + '/aidsp/dataset/filedownload/' +data.path,'status':'done'}]})\r\n      }\r\n    })\r\n  };\r\n  uploadOnchange = info => {\r\n    let fileList = [...info.fileList];\r\n\r\n    // 1. Limit the number of uploaded files\r\n    // Only to show two recent uploaded files, and old ones will be replaced by the new\r\n    fileList = fileList.slice(-2);\r\n\r\n    // 2. Read from response and show file link\r\n    fileList = fileList.map(file => {\r\n      if (file.response) {\r\n        // Component will show file.url as link\r\n        file.url = file.response.url;\r\n      }\r\n      return file;\r\n    });\r\n    if (fileList[0] && fileList[0].status == 'done'){\r\n      fileList[0].name = fileList[0].response;\r\n      fileList[0].url = window.location.protocol + \"//\"+window.location.host + '/aidsp/dataset/filedownload/' + fileList[0].response;\r\n    }\r\n\r\n    this.setState({ fileList });\r\n\r\n  }\r\n  showpreview = e =>{\r\n    console.log(e)\r\n  }\r\n\r\n\r\n  render() {\r\n    const { getFieldDecorator } = this.props.form;\r\n    const formItemLayout = {\r\n      labelCol: { span: 6 },\r\n      wrapperCol: { span: 14 },\r\n    };\r\n    const { previewVisible, previewImage, fileList } = this.state;\r\n    const uploadButton = (\r\n      <div>\r\n        <Icon type={this.state.loading ? 'loading' : 'plus'} />\r\n        <div className=\"ant-upload-text\">Upload</div>\r\n      </div>\r\n    );\r\n    const { imageUrl } = this.state;\r\n\r\n    return (\r\n      <Form {...formItemLayout} onSubmit={this.handleSubmit}>\r\n        <Form.Item label=\"数据集名称\" >\r\n          {getFieldDecorator('name', {\r\n            rules: [{ required: true, message: '请输入数据集名称!' }],\r\n          })(\r\n            <Input  placeholder=\"请输入项目名称\" ></Input>,\r\n          )}\r\n        </Form.Item>\r\n        <Form.Item label=\"项目\">\r\n          {getFieldDecorator('project_id', {\r\n            rules: [{ required: true, message: '请选择所属项目!' }],\r\n          })(\r\n            <Select placeholder=\"请选择所属项目\"\r\n             showSearch \r\n             filterOption={(input, option) =>\r\n                option.props.children.toLowerCase().indexOf(input.toLowerCase()) >= 0\r\n              }>\r\n                {this.state.Options}              \r\n\r\n            </Select>,\r\n          )}\r\n        </Form.Item>\r\n    \r\n\r\n        <Form.Item label=\"数据集描述\" >\r\n          {getFieldDecorator('describe', {\r\n            \r\n          })(\r\n            <Input placeholder=\"请输入数据集描述\"></Input>,\r\n          )}\r\n        </Form.Item>\r\n        <Form.Item label=\"数量详情\" >\r\n          {getFieldDecorator('quantity_detials', {\r\n            \r\n          })(\r\n            <Input placeholder=\"请输入数量详情\"></Input>,\r\n          )}\r\n        </Form.Item>\r\n        <Form.Item label=\"存储路径\">\r\n          {/*getFieldDecorator('upload', {\r\n            getValueFromEvent: this.normFile,\r\n          })(\r\n              <Upload  \r\n                action='/aidsp/dataset/fileupload/'\r\n                onChange={this.uploadOnchange}\r\n                fileList={this.state.fileList}\r\n                showUploadList ={{showPreviewIco:false,showRemoveIcon:true,showDownloadIcon:true}  } \r\n                onPreview = {this.showpreview}\r\n\r\n              >\r\n                {this.state.fileList[0] ? '':\r\n                <Button>\r\n                  <Icon type=\"upload\" /> 上传文件\r\n                </Button>}\r\n\r\n              </Upload>,\r\n          )*/}\r\n          {getFieldDecorator('path', {\r\n            \r\n          })(\r\n            <Input placeholder=\"请输入存储路径\"></Input>,\r\n          )}\r\n        </Form.Item>\r\n    \r\n        <Form.Item label=\"略缩图\">\r\n          {getFieldDecorator('xx', {\r\n          })(\r\n      <Upload\r\n        name=\"avatar\"\r\n        listType=\"picture-card\"\r\n        showUploadList={false}\r\n        onChange={this.handleChange}\r\n\r\n      >\r\n        {imageUrl ? <img src={imageUrl} alt=\"avatar\" style={{ width: '100%' }} /> : uploadButton}\r\n      </Upload>\r\n        )}\r\n          <Modal visible={previewVisible} footer={null} onCancel={this.handleCancel}>\r\n          <img alt=\"example\" style={{ width: '100%' }} src={previewImage} />\r\n        </Modal>\r\n        \r\n              </Form.Item>\r\n\r\n\r\n        <Form.Item wrapperCol={{ span: 12, offset: 6 }}>\r\n          <Button type=\"primary\" htmlType=\"submit\">\r\n            提交\r\n          </Button>\r\n        </Form.Item>\r\n      </Form>\r\n    );\r\n  }\r\n}\r\n\r\nconst WrappedDemo = Form.create({ name: 'validate_other' })(Demo);\r\n\r\nReactDOM.render(<WrappedDemo />, document.getElementById('container'));\r\n"],"sourceRoot":""}